# Итоговый отчет по курсовой работе: Информационная система ItDrive

## Введение

ItDrive - информационная система для организации шеринговых поездок между корпусами университета ИТМО. Система позволяет студентам и преподавателям быстро находить попутчиков для поездок между корпусами университета.

## 1. Описание предметной области

### 1.1. Назначение системы

Система ItDrive предназначена для:
- Организации поездок между корпусами университета
- Поиска попутчиков среди студентов и преподавателей
- Управления бронированиями мест в поездках
- Обеспечения системы рейтингов и отзывов
- Административного управления системой

### 1.2. Основные роли

1. **Водитель** - создает поездки, управляет маршрутами, принимает пассажиров
2. **Пассажир** - ищет подходящие поездки, бронирует места
3. **Администратор** - управляет системой, просматривает статистику

## 2. Архитектура системы

### 2.1. Технологический стек

**Backend:**
- Spring Boot 3.2.0
- Spring Data JPA
- Spring Security с JWT
- PostgreSQL с PL/PGSQL
- Druid Connection Pool
- Jakarta Validation

**База данных:**
- PostgreSQL 15+

### 2.2. Структура проекта

```
ItDrive/
├── src/main/java/ru/itmo/itdrive/
│   ├── config/          # Конфигурация безопасности
│   ├── controller/      # REST контроллеры
│   ├── dto/             # Data Transfer Objects
│   ├── filter/          # JWT фильтр
│   ├── model/           # Модели данных (entities)
│   ├── repository/      # Репозитории (уровень хранения)
│   ├── service/         # Сервисы (бизнес-логика)
│   └── util/            # Утилиты
├── src/main/resources/
│   ├── db/
│   │   ├── migration/   # PL/PGSQL функции
│   │   └── schema.sql   # Схема БД
│   └── application.yml  # Конфигурация приложения
└── docs/                # Документация
```

## 3. Реализация этапов

### 3.1. Этап 1: Анализ предметной области

**Выполнено:**
- Описана предметная область
- Определены функциональные требования
- Описаны бизнес-процессы (Use Cases)

**Основные функции:**
1. Регистрация и авторизация пользователей
2. Создание поездок водителями
3. Поиск и бронирование поездок пассажирами
4. Управление поездками (начало, завершение, отмена)
5. Система отзывов и рейтингов
6. Административные функции

### 3.2. Этап 2: Проектирование базы данных

**Выполнено:**
- Спроектирована даталогическая модель
- Созданы таблицы для всех сущностей
- Определены связи между таблицами
- Созданы индексы для оптимизации

**Основные таблицы:**
- `users` - пользователи системы
- `drivers` - информация о водителях
- `buildings` - корпуса университета
- `trips` - поездки
- `bookings` - бронирования
- `reviews` - отзывы
- `payments` - платежи

### 3.3. Этап 3: Реализация уровня хранения и бизнес-логики

**Выполнено:**
- Создана диаграмма классов
- Реализованы модели данных (JPA Entities)
- Созданы репозитории с использованием PL/PGSQL функций
- Реализованы сервисы бизнес-логики
- Настроена JWT авторизация

**PL/PGSQL функции:**
- `create_user` - создание пользователя
- `create_trip` - создание поездки
- `create_booking` - создание бронирования
- `confirm_booking` - подтверждение бронирования
- `cancel_booking` - отмена бронирования
- `start_trip` - начало поездки
- `complete_trip` - завершение поездки
- `create_review` - создание отзыва
- `update_user_rating` - обновление рейтинга
- `get_trip_statistics` - статистика поездок
- `get_popular_routes` - популярные маршруты

### 3.4. Этап 4: Реализация уровня представления

**Выполнено:**
- Реализованы REST API контроллеры
- Настроена безопасность с JWT
- Реализованы все эндпоинты согласно требованиям

**REST API эндпоинты:**

#### Авторизация
- `POST /api/auth/register` - Регистрация
- `POST /api/auth/login` - Авторизация

#### Поездки
- `POST /api/trips` - Создать поездку
- `GET /api/trips` - Поиск поездок
- `GET /api/trips/{id}` - Получить поездку
- `GET /api/trips/driver/{driverId}` - Поездки водителя
- `PUT /api/trips/{id}/start` - Начать поездку
- `PUT /api/trips/{id}/complete` - Завершить поездку
- `DELETE /api/trips/{id}` - Отменить поездку

#### Бронирования
- `POST /api/bookings` - Создать бронирование
- `GET /api/bookings/passenger/{passengerId}` - Бронирования пассажира
- `GET /api/bookings/trip/{tripId}` - Бронирования поездки
- `PUT /api/bookings/{id}/confirm` - Подтвердить бронирование
- `DELETE /api/bookings/{id}` - Отменить бронирование

#### Отзывы
- `POST /api/reviews` - Создать отзыв
- `GET /api/reviews/user/{userId}` - Отзывы о пользователе

#### Администрирование
- `GET /api/admin/statistics` - Статистика системы
- `GET /api/admin/routes/popular` - Популярные маршруты
- `GET /api/admin/users` - Все пользователи
- `PUT /api/admin/users/{id}/block` - Заблокировать пользователя
- `PUT /api/admin/users/{id}/unblock` - Разблокировать пользователя

#### Пользователи
- `GET /api/users/{id}` - Получить пользователя
- `PUT /api/users/{id}/role` - Изменить роль

## 4. Особенности реализации

### 4.1. Использование PL/PGSQL функций

Все ключевые операции выполняются через PL/PGSQL функции, что обеспечивает:
- Бизнес-логику на уровне БД
- Атомарность операций
- Производительность
- Безопасность данных

### 4.2. Безопасность

- JWT токены для аутентификации
- Ролевая модель доступа (DRIVER, PASSENGER, ADMIN)
- Хеширование паролей (BCrypt)
- Фильтрация запросов через JWT фильтр

### 4.3. Валидация

- Валидация входных данных через Jakarta Validation
- Проверка прав доступа в сервисном слое
- Обработка исключений

## 5. Установка и запуск

### 5.1. Требования

- Java 17+
- Maven 3.8+
- PostgreSQL 15+
- Docker (опционально)

### 5.2. Настройка базы данных

1. Создать базу данных:
```sql
CREATE DATABASE "tikhon-pc";
```

2. Выполнить схему БД:
```bash
psql -U tikhon-pc -d tikhon-pc -f src/main/resources/db/schema.sql
```

3. Создать PL/PGSQL функции:
```bash
psql -U tikhon-pc -d tikhon-pc -f src/main/resources/db/migration/V1__create_functions.sql
```

### 5.3. Конфигурация

Настроить `application.yml`:
```yaml
spring:
  datasource:
    druid:
      url: jdbc:postgresql://localhost:5432/tikhon-pc
      username: tikhon-pc
      password: 123
```

### 5.4. Запуск

```bash
mvn clean install
mvn spring-boot:run
```

Приложение запустится на порту 8080.

## 6. Тестирование

### 6.1. Тестовые данные

Рекомендуется создать тестовые данные:
- Корпуса университета
- Тестовых пользователей (водителей и пассажиров)

### 6.2. Примеры запросов

**Регистрация:**
```bash
POST /api/auth/register
{
  "email": "driver@example.com",
  "password": "password123",
  "firstName": "Иван",
  "lastName": "Иванов",
  "role": "DRIVER"
}
```

**Создание поездки:**
```bash
POST /api/trips
Authorization: Bearer {token}
{
  "fromBuildingId": 1,
  "toBuildingId": 2,
  "departureTime": "2025-01-20T10:00:00",
  "maxPassengers": 3,
  "price": 100.00
}
```

## 7. Заключение

Система ItDrive успешно реализована и соответствует всем требованиям курсовой работы:

✅ **Этап 1**: Описана предметная область и функциональные требования  
✅ **Этап 2**: Спроектирована и реализована база данных  
✅ **Этап 3**: Реализован уровень хранения и бизнес-логики с использованием PL/PGSQL  
✅ **Этап 4**: Реализован уровень представления (REST API)  

Система готова к развертыванию и использованию.

## 8. Дальнейшее развитие

Возможные направления развития:
- Мобильное приложение (React Native)
- Административная панель (React)
- Интеграция с картами для построения маршрутов
- Push-уведомления
- Интеграция с платежными системами
- Система промокодов и скидок

---

**Авторы:** Прадед В. В., Дмитриев Т. А.  
**Группа:** Р3306  
**Год:** 2025
